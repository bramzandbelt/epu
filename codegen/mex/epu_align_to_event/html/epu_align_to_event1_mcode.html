<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1"> 1</a></span><span class="line"><span class="keyword">function</span> <span class="var type1" id="S2T16U3">alignedArray</span> = <span class="message warning" id="M1F1C">epu_align_to_event</span>(<span class="var type1" id="S3T1U6">rt</span>,<span class="var type1" id="S4T4U7">outputTimeFrame</span>,<span class="var type1" id="S5T1U8">minTrialTime</span>,<span class="var type1" id="S6T5U9">trajectories</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2"> 2</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3"> 3</a></span><span class="line"><span class="comment">% Usage alignedArray = align_to_rt(rt,outputTimeFrame,minTrialTime,trajectories)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4"> 4</a></span><span class="line"><span class="comment">% rt                 - scalar, response time</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5"> 5</a></span><span class="line"><span class="comment">% outputTimeFrame    - 1x2 vector containing the time frame for which to plot</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6"> 6</a></span><span class="line"><span class="comment">%                    data</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7"> 7</a></span><span class="line"><span class="comment">% minTrialTime       - scalar, the time (in ms) for the first data point in input array</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8"> 8</a></span><span class="line"><span class="comment">% trajectories       - 1xN vector containing activation trajectory for this trial</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9"> 9</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10">10</a></span><span class="line"><span class="comment">% Based on Mathew Nelson's ADAlignTrials</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11">11</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12">12</a></span><span class="line"><span class="comment">% Bram Zandbelt, November 2011</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13">13</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14">14</a></span><span class="line"><span class="comment">% Handling input arguments</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15">15</a></span><span class="line"><span class="keyword">if</span> nargin&lt;4 </span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16">16</a></span><span class="line">   error([<span class="string">'Current number of input arguments is '</span> num2str(nargin) <span class="string">'. At least 4 arguments are needed.'</span>]);</span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17">17</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18">18</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19">19</a></span><span class="line"><span class="comment">% Round data</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20">20</a></span><span class="line"><span class="mxinfo" id="T1:U6"><span class="var type1" id="S3T1U29">rt</span>=<span class="mxinfo" id="T1:U8">round(<span class="var type1" id="S3T1U32">rt</span>)</span></span>;     </span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21">21</a></span><span class="line"><span class="mxinfo" id="T4:U10"><span class="var type1" id="S4T4U35">outputTimeFrame</span>=<span class="mxinfo" id="T4:U12">round(<span class="var type1" id="S4T4U38">outputTimeFrame</span>)</span></span>;   </span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22">22</a></span><span class="line"><span class="mxinfo" id="T1:U14"><span class="var type1" id="S5T1U41">minTrialTime</span>=<span class="mxinfo" id="T1:U16">round(<span class="var type1" id="S5T1U44">minTrialTime</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23">23</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24">24</a></span><span class="line"><span class="mxinfo" id="T4:U18"><span class="var type1" id="S11T4U47">inputTimeFrame</span> = <span class="mxinfo" id="T4:U20">[<span class="var type1" id="S5T1U50">minTrialTime</span>,<span class="mxinfo" id="T1:U22"><span class="mxinfo" id="T1:U23"><span class="var type1" id="S5T1U53">minTrialTime</span>+<span class="mxinfo" id="T1:U25">size(<span class="var type1" id="S6T5U56">trajectories</span>,2)</span></span>-<span class="mxinfo" id="T1:U27">1</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25">25</a></span><span class="line"><span class="mxinfo" id="T4:U28"><span class="var type1" id="S13T4U61">timeFrameInterest</span> = <span class="mxinfo" id="T4:U30"><span class="var type1" id="S3T1U63">rt</span>+<span class="var type1" id="S4T4U64">outputTimeFrame</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26">26</a></span><span class="line"><span class="mxinfo" id="T4:U33"><span class="var type1" id="S14T4U67">absTimeFrame</span> = <span class="mxinfo" id="T4:U35">[<span class="mxinfo" id="T1:U36">min(<span class="mxinfo" id="T9:U37">[<span class="var type1" id="S11T4U74">inputTimeFrame</span>,<span class="var type1" id="S13T4U75">timeFrameInterest</span>]</span>)</span>,<span class="mxinfo" id="T1:U40">max(<span class="mxinfo" id="T9:U41">[<span class="var type1" id="S11T4U80">inputTimeFrame</span>,<span class="var type1" id="S13T4U81">timeFrameInterest</span>]</span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27">27</a></span><span class="line"><span class="mxinfo" id="T1:U44"><span class="var type1" id="S17T1U84">absNSamples</span> = <span class="mxinfo" id="T1:U46"><span class="mxinfo" id="T1:U47">diff(<span class="var type1" id="S14T4U88">absTimeFrame</span>)</span>+<span class="mxinfo" id="T1:U49">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28">28</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29">29</a></span><span class="line"><span class="mxinfo" id="T16:U50"><span class="var type1" id="S19T16U92">t</span>=<span class="mxinfo" id="T16:U52"><span class="mxinfo" id="T16:U53">repmat(<span class="mxinfo" id="T16:U54"><span class="mxinfo" id="T1:U55"><span class="var type1" id="S14T4U99">absTimeFrame</span>(<span class="mxinfo" id="T1:U57">1</span>)</span>:1:<span class="mxinfo" id="T1:U58"><span class="var type1" id="S14T4U103">absTimeFrame</span>(<span class="mxinfo" id="T1:U60">2</span>)</span></span>,1,1)</span>-<span class="mxinfo" id="T16:U61">repmat(<span class="var type1" id="S3T1U109">rt</span>,1,<span class="var type1" id="S17T1U111">absNSamples</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30">30</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31">31</a></span><span class="line"><span class="mxinfo" id="T16:U64"><span class="var type1" id="S21T16U114">currentArray</span> = <span class="var type1" id="S6T5U115">trajectories</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32">32</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T3:U67"><span class="mxinfo" id="T1:U68">min(<span class="var type1" id="S14T4U121">absTimeFrame</span>)</span> &lt; <span class="mxinfo" id="T1:U70">min(<span class="var type1" id="S11T4U124">inputTimeFrame</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33">33</a></span><span class="line">   <span class="mxinfo" id="T16:U72"><span class="var type1" id="S21T16U127">currentArray</span> = <span class="mxinfo" id="T16:U74">[<span class="mxinfo" id="T16:U75">nan(<span class="mxinfo" id="T1:U76">1</span>,<span class="mxinfo" id="T1:U77"><span class="mxinfo" id="T1:U78">min(<span class="var type1" id="S11T4U136">inputTimeFrame</span>)</span>-<span class="mxinfo" id="T1:U80">min(<span class="var type1" id="S14T4U139">absTimeFrame</span>)</span></span>)</span>,<span class="var type1" id="S21T16U140">currentArray</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34">34</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35">35</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36">36</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T3:U83"><span class="mxinfo" id="T1:U84">max(<span class="var type1" id="S14T4U146">absTimeFrame</span>)</span> &gt; <span class="mxinfo" id="T1:U86">max(<span class="var type1" id="S11T4U149">inputTimeFrame</span>)</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37">37</a></span><span class="line">   <span class="mxinfo" id="T16:U88"><span class="var type1" id="S21T16U152">currentArray</span> = <span class="mxinfo" id="T16:U90">[<span class="var type1" id="S21T16U155">currentArray</span>,<span class="mxinfo" id="T16:U92">nan(<span class="mxinfo" id="T1:U93">1</span>,<span class="mxinfo" id="T1:U94"><span class="mxinfo" id="T1:U95">max(<span class="var type1" id="S14T4U162">absTimeFrame</span>)</span>-<span class="mxinfo" id="T1:U97">max(<span class="var type1" id="S11T4U165">inputTimeFrame</span>)</span></span>)</span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38">38</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39">39</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40">40</a></span><span class="line"><span class="mxinfo" id="T18:U99"><span class="var type1" id="S21T18U168">currentArray</span> = <span class="mxinfo" id="T18:U101"><span class="var type1" id="S21T16U170">currentArray</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41">41</a></span><span class="line"><span class="mxinfo" id="T18:U103"><span class="var type1" id="S19T18U173">t</span> = <span class="mxinfo" id="T18:U105"><span class="var type1" id="S19T16U175">t</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42">42</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43">43</a></span><span class="line"><span class="mxinfo" id="T16:U107"><span class="var type1" id="S2T16U178">alignedArray</span> = <span class="mxinfo" id="T16:U109"><span class="mxinfo" id="T18:U110">reshape(<span class="mxinfo" id="T18:U111"><span class="var type1" id="S21T18U183">currentArray</span>( <span class="mxinfo" id="T19:U113"><span class="mxinfo" id="T19:U114"><span class="var type1" id="S19T18U186">t</span>&gt;=<span class="mxinfo" id="T1:U116"><span class="var type1" id="S4T4U188">outputTimeFrame</span>(<span class="mxinfo" id="T1:U118">1</span>)</span></span> &amp; <span class="mxinfo" id="T19:U119"><span class="var type1" id="S19T18U191">t</span>&lt;=<span class="mxinfo" id="T1:U121"><span class="var type1" id="S4T4U193">outputTimeFrame</span>(<span class="mxinfo" id="T1:U123">2</span>)</span></span></span> )</span>,<span class="mxinfo" id="T1:U124"><span class="mxinfo" id="T1:U125">diff(<span class="var type1" id="S4T4U198">outputTimeFrame</span>)</span>+<span class="mxinfo" id="T1:U127">1</span></span>,1)</span>'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44">44</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45">45</a></span><span class="line"> </span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46">46</a></span><span class="line"> </span></span>
</pre>
