<pre class="code">
<span class="srcline"><span class="lineno"><a href="1,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T2U3">rt</span>,<span class="var type1" id="S3T14U4">activation</span>] = epu_n_unit_accumulator(<span class="var type1" id="S4T2U7">nTP</span>,<span class="var type1" id="S5T1U8">v</span>,<span class="var type1" id="S6T2U9">sigmaXi</span>,<span class="var type1" id="S7T16U10">SigmaXi</span>,<span class="var type1" id="S8T1U11">theta</span>,<span class="var type1" id="S9T1U12">k</span>,<span class="var type1" id="S10T2U13">affTime</span>,<span class="var type1" id="S11T2U14">effTime</span>,<span class="var type1" id="S12T1U15">pN</span>,<span class="var type1" id="S13T2U16">dMeth</span>,<span class="var type1" id="S14T1U17">iAT</span>) <span class="comment">%#codegen</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%% N-UNIT REDUNDANT ACCUMULATOR MODEL WITHOUT LATERAL INHIBITION</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,3" id="srcline3">  3</a></span><span class="line"><span class="comment">% INPUTS</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% nTP           - number of time points (TP) for which to log data (in ms from</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%                 target onset)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,6" id="srcline6">  6</a></span><span class="line"><span class="comment">% v             - vector with accumulation rates across accumulators</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%                 * units:          spikes s-1 ms-1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%                 * size &amp; class:   1xnA double, where nA is number of</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%                                   accumulators</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%                 * support:        v ? ?: (0,+?)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">% sigmaXi       - scale parameter of the Gaussian noise distribution</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%                 * units:          spikes s-1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%                 * size &amp; class:   1x1 double</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%                 * support:        sigmaXi ? ?: (0,+?)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">% SigmaXi       - Cholesky-like decomposed covariance matrix</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">%                 * units:          ?</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">%                 * size &amp; class:   nAxnA double</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">%                 * support:        SigmaXi</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">% theta         - vector with thresholds across accumulators</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">%                 * units:          spikes s-1</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">%                 * size &amp; class:   1xnA double, where nA is number of</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%                                   accumulators</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">%                 * support:        theta ? ?: (0,+?)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">% k             - vector with leakage parameters</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">%                 * units:          </span></span></span>
<span class="srcline"><span class="lineno"><a href="1,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">%                 * size &amp; class:   1xnA double, where nA is number of</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">%                                   accumulators</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%                 * support:        k ? ?: (0,+?)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">% affTime       - afferent (encoding) time</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">%                 * units:          ms</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%                 * size &amp; class:   1x1 double</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">%                 * support:        affTime ? ?: [0,+?)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">% effTime       - efferent (response execution) time</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">%                 * units:          ms</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">%                 * size &amp; class:   1x1 double</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">%                 * support:        effTime ? ?: [0,+?)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">% pN            - proportion of accumulators necessary to produce an RT ('RT</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">%                 rule').</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">%                 * units:          unitless</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">%                 * size &amp; class:   1x1 double</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">%                 * support:        pN ? ?: [0,1], where 0 means that the very</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">%                 first accumulator reaching threshold produces RT</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">% dMeth         - decision method, polling or pooling</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,44" id="srcline44"> 44</a></span><span class="line"><span class="comment">%                 * units:          unitless</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">%                 * size &amp; class:   1x1 double</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">%                 * support:        * 1   polling</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">%                                   * 2   pooling</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">% iAT           - accumulators indices for which to provide accumulation</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,49" id="srcline49"> 49</a></span><span class="line"><span class="comment">%                 trajectories</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">%                 * units:          unitless</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,51" id="srcline51"> 51</a></span><span class="line"><span class="comment">%                 * size &amp; class:   1xN double, where N is the number of indices</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">%                 to get and N &lt;= nA, where nA is number of accumulators</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,53" id="srcline53"> 53</a></span><span class="line"><span class="comment">%                 * support:        iAT ? ?: [1,nA]</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,54" id="srcline54"> 54</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,55" id="srcline55"> 55</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">% EXAMPLE USAGE:</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,57" id="srcline57"> 57</a></span><span class="line"><span class="comment">% nTP = 1500;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,58" id="srcline58"> 58</a></span><span class="line"><span class="comment">% v = 1+randn(1,10);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">% sigmaXi = .2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">% rXi = .5;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">% theta = 100.*ones(1,10);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,62" id="srcline62"> 62</a></span><span class="line"><span class="comment">% k = zeros(1,10);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,63" id="srcline63"> 63</a></span><span class="line"><span class="comment">% affTime = 100;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,64" id="srcline64"> 64</a></span><span class="line"><span class="comment">% effTime = 10;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,65" id="srcline65"> 65</a></span><span class="line"><span class="comment">% pN = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,66" id="srcline66"> 66</a></span><span class="line"><span class="comment">% dMeth = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,67" id="srcline67"> 67</a></span><span class="line"><span class="comment">% iAT = [1,3,5];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,68" id="srcline68"> 68</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,69" id="srcline69"> 69</a></span><span class="line"><span class="comment">% [rt,activation] = <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,70" id="srcline70"> 70</a></span><span class="line"><span class="comment">% epu_n_unit_accumulator(nTP,v,sigmaXi,SigmaXi,theta,k,affTime,effTime,pN,dMeth,iAT);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,72" id="srcline72"> 72</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,73" id="srcline73"> 73</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,74" id="srcline74"> 74</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,75" id="srcline75"> 75</a></span><span class="line"><span class="comment">% THESE EXAMPLES NEED TO BE UPDATED AND ADJUSTED!</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,76" id="srcline76"> 76</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,77" id="srcline77"> 77</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,78" id="srcline78"> 78</a></span><span class="line"><span class="comment">%% Example 1: Perfect integration of evidence, polling-based RT generation, very</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,79" id="srcline79"> 79</a></span><span class="line"><span class="comment">%% first accumulator reaching threshold determines RT</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,80" id="srcline80"> 80</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,81" id="srcline81"> 81</a></span><span class="line"><span class="comment">% muRate = 1+randn(1,10);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,82" id="srcline82"> 82</a></span><span class="line"><span class="comment">% wnF = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,83" id="srcline83"> 83</a></span><span class="line"><span class="comment">% nTP = 1500;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,84" id="srcline84"> 84</a></span><span class="line"><span class="comment">% k = zeros(1,10);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,85" id="srcline85"> 85</a></span><span class="line"><span class="comment">% theta = 100 .* ones(1,10);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,86" id="srcline86"> 86</a></span><span class="line"><span class="comment">% t0 = 100;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,87" id="srcline87"> 87</a></span><span class="line"><span class="comment">% dMeth = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,88" id="srcline88"> 88</a></span><span class="line"><span class="comment">% q = 0;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,89" id="srcline89"> 89</a></span><span class="line"><span class="comment">% iAT = [1 3 4];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,90" id="srcline90"> 90</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,91" id="srcline91"> 91</a></span><span class="line"><span class="comment">% [rt,activation] = <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,92" id="srcline92"> 92</a></span><span class="line"><span class="comment">% epu_n_unit_accumulator(muRate,wnF,nTP,k,theta,t0,dMeth,q,iAT);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,93" id="srcline93"> 93</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,94" id="srcline94"> 94</a></span><span class="line"><span class="comment">%% Example 2: Leaky integration of evidence, polling-based RT generation, median</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,95" id="srcline95"> 95</a></span><span class="line"><span class="comment">%% accumulator reaching threshold determines RT</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,96" id="srcline96"> 96</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,97" id="srcline97"> 97</a></span><span class="line"><span class="comment">% muRate = 1+randn(1,10);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,98" id="srcline98"> 98</a></span><span class="line"><span class="comment">% wnF = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,99" id="srcline99"> 99</a></span><span class="line"><span class="comment">% nTP = 1500</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,100" id="srcline100">100</a></span><span class="line"><span class="comment">% theta = 100 .* ones(1,10);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,101" id="srcline101">101</a></span><span class="line"><span class="comment">% k = 0.5.*muRate./theta;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,102" id="srcline102">102</a></span><span class="line"><span class="comment">% t0 = 100;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,103" id="srcline103">103</a></span><span class="line"><span class="comment">% dMeth = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,104" id="srcline104">104</a></span><span class="line"><span class="comment">% q = 0.5;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,105" id="srcline105">105</a></span><span class="line"><span class="comment">% iAT = [1 3 4];</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,106" id="srcline106">106</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,107" id="srcline107">107</a></span><span class="line"><span class="comment">% [rt,activation] = <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,108" id="srcline108">108</a></span><span class="line"><span class="comment">% epu_n_unit_accumulator(muRate,wnF,nTP,k,theta,t0,dMeth,q,iAT);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,109" id="srcline109">109</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,110" id="srcline110">110</a></span><span class="line"><span class="comment">%% Example 3: Leaky integration of evidence, pooling-based RT generation</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,111" id="srcline111">111</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,112" id="srcline112">112</a></span><span class="line"><span class="comment">% muRate = 1+randn(1,10);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,113" id="srcline113">113</a></span><span class="line"><span class="comment">% wnF = 1;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,114" id="srcline114">114</a></span><span class="line"><span class="comment">% nTP = 1500;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,115" id="srcline115">115</a></span><span class="line"><span class="comment">% theta = 100 .* ones(1,10);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,116" id="srcline116">116</a></span><span class="line"><span class="comment">% k = 0.5.*muRate./theta;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,117" id="srcline117">117</a></span><span class="line"><span class="comment">% t0 = 100;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,118" id="srcline118">118</a></span><span class="line"><span class="comment">% dMeth = 2;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,119" id="srcline119">119</a></span><span class="line"><span class="comment">% q = 0.5;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,120" id="srcline120">120</a></span><span class="line"><span class="comment">% iAT = 10;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,121" id="srcline121">121</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,122" id="srcline122">122</a></span><span class="line"><span class="comment">% [rt,activation] = <span class="keyword">...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,123" id="srcline123">123</a></span><span class="line"><span class="comment">% epu_n_unit_accumulator(muRate,wnF,nTP,k,theta,t0,dMeth,q,iAT);</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,124" id="srcline124">124</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,125" id="srcline125">125</a></span><span class="line"><span class="comment">% Bram Zandbelt, April 2012</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,126" id="srcline126">126</a></span><span class="line"><span class="comment">%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,127" id="srcline127">127</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,128" id="srcline128">128</a></span><span class="line"><span class="comment">%% 1. Parameter settings &amp; array pre-allocation</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,129" id="srcline129">129</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,130" id="srcline130">130</a></span><span class="line"><span class="message error" id="M1F1C">warning</span> <span class="string">off</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,131" id="srcline131">131</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,132" id="srcline132">132</a></span><span class="line"><span class="comment">% Constants</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,133" id="srcline133">133</a></span><span class="line"><span class="mxinfo" id="T2:U14"><span class="var type1" id="S16T2U23">DT</span> = <span class="mxinfo" id="T2:U16">5</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,134" id="srcline134">134</a></span><span class="line"><span class="mxinfo" id="T2:U17"><span class="var type1" id="S17T2U27">TAU</span> = <span class="mxinfo" id="T2:U19">1</span></span>; <span class="comment">% Time scale (in ms), see Usher &amp; McClelland 2001, p. 558</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,135" id="srcline135">135</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,136" id="srcline136">136</a></span><span class="line"><span class="comment">% User-defined parameters</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,137" id="srcline137">137</a></span><span class="line"><span class="mxinfo" id="T2:U20"><span class="var type1" id="S18T2U31">nA</span> = <span class="mxinfo" id="T2:U22">size(<span class="var type1" id="S5T1U34">v</span>,2)</span></span>; <span class="comment">% Number of accumulator units</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,138" id="srcline138">138</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,139" id="srcline139">139</a></span><span class="line"><span class="comment">% Arrays for logging data</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,140" id="srcline140">140</a></span><span class="line"><span class="mxinfo" id="T14:U24"><span class="var type1" id="S3T14U38">activation</span> = <span class="mxinfo" id="T14:U26">[<span class="mxinfo" id="T14:U27">zeros(<span class="mxinfo" id="T2:U28">floor(<span class="mxinfo" id="T2:U29"><span class="var type1" id="S10T2U46">affTime</span>./<span class="mxinfo" id="T2:U31"><span class="var type1" id="S16T2U47">DT</span></span></span>)</span>,<span class="var type1" id="S18T2U48">nA</span>)</span>;<span class="mxinfo" id="T14:U34">nan(<span class="mxinfo" id="T2:U35">ceil(<span class="mxinfo" id="T2:U36">(<span class="mxinfo" id="T2:U37"><span class="var type1" id="S4T2U57">nTP</span>-<span class="var type1" id="S10T2U58">affTime</span></span>)./<span class="mxinfo" id="T2:U40"><span class="var type1" id="S16T2U59">DT</span></span></span>)</span>,<span class="var type1" id="S18T2U60">nA</span>)</span>]</span></span>; <span class="comment">% Activation</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,141" id="srcline141">141</a></span><span class="line"><span class="mxinfo" id="T2:U43"><span class="var type1" id="S2T2U63">rt</span> = <span class="mxinfo" id="T2:U45">Inf</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,142" id="srcline142">142</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,143" id="srcline143">143</a></span><span class="line"><span class="comment">%% 2. Accumulator trajectories</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,144" id="srcline144">144</a></span><span class="line"><span class="comment">% iTP = affTime+1; % Before affTime, activation is zero</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,145" id="srcline145">145</a></span><span class="line"><span class="mxinfo" id="T2:U46"><span class="var type1" id="S25T2U68">iTP</span> = <span class="mxinfo" id="T2:U48"><span class="mxinfo" id="T2:U49">floor(<span class="mxinfo" id="T2:U50"><span class="var type1" id="S10T2U73">affTime</span>./<span class="mxinfo" id="T2:U52"><span class="var type1" id="S16T2U74">DT</span></span></span>)</span>+<span class="mxinfo" id="T2:U54">1</span></span></span>; <span class="comment">% Before affTime, activation is zero</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,146" id="srcline146">146</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,147" id="srcline147">147</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T7:U55">all(<span class="mxinfo" id="T40:U56"><span class="var type1" id="S12T1U81">pN</span> == <span class="mxinfo" id="T2:U58">0</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,148" id="srcline148">148</a></span><span class="line">   <span class="mxinfo" id="T1:U59"><span class="var type1" id="S12T1U85">pN</span> = <span class="mxinfo" id="T2:U61">realmin</span></span>; <span class="comment">% This ensures that very first accumulator determines RT</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,149" id="srcline149">149</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,150" id="srcline150">150</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,151" id="srcline151">151</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T7:U62"><span class="var type1" id="S13T2U91">dMeth</span> == <span class="mxinfo" id="T2:U64">1</span></span> <span class="comment">% Polling</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,152" id="srcline152">152</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,153" id="srcline153">153</a></span><span class="line">   <span class="keyword">while</span> <span class="mxinfo" id="T7:U65"><span class="var type1" id="S25T2U95">iTP</span> &lt; <span class="mxinfo" id="T2:U67">Inf</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,154" id="srcline154">154</a></span><span class="line">      <span class="comment">% Proportion of accumulators with activation above threshold</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,155" id="srcline155">155</a></span><span class="line">      <span class="mxinfo" id="T2:U68"><span class="var type1" id="S28T2U100">prop</span> = <span class="mxinfo" id="T2:U70"><span class="mxinfo" id="T2:U71">sum(<span class="mxinfo" id="T3:U72"><span class="mxinfo" id="T20:U73"><span class="var type1" id="S3T14U106">activation</span>(<span class="var type1" id="S25T2U107">iTP</span>,:)</span> &gt; <span class="var type1" id="S8T1U109">theta</span></span>)</span>/<span class="var type1" id="S18T2U110">nA</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,156" id="srcline156">156</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,157" id="srcline157">157</a></span><span class="line">      <span class="comment">% Generate correlated Gaussian noise</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,158" id="srcline158">158</a></span><span class="line">      <span class="mxinfo" id="T20:U78"><span class="var type1" id="S30T20U113">Xi</span> = <span class="mxinfo" id="T20:U80"><span class="mxinfo" id="T20:U81"><span class="mxinfo" id="T20:U82">randn(1,<span class="mxinfo" id="T2:U83">size(<span class="var type1" id="S7T16U121">SigmaXi</span>,1)</span>)</span> * <span class="var type1" id="S7T16U123">SigmaXi</span></span> + <span class="mxinfo" id="T20:U86">zeros(<span class="mxinfo" id="T2:U87">1</span>,<span class="var type1" id="S18T2U127">nA</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,159" id="srcline159">159</a></span><span class="line">         </span></span>
<span class="srcline"><span class="lineno"><a href="1,160" id="srcline160">160</a></span><span class="line">      <span class="comment">% Compute activation level</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,161" id="srcline161">161</a></span><span class="line">      <span class="mxinfo" id="T20:U89"><span class="mxinfo" id="T20:U90"><span class="var type1" id="S3T14U131">activation</span>(<span class="var type1" id="S25T2U132">iTP</span>,:)</span> = <span class="mxinfo" id="T20:U93"><span class="mxinfo" id="T20:U94"><span class="mxinfo" id="T20:U95"><span class="var type1" id="S3T14U137">activation</span>(<span class="mxinfo" id="T2:U97"><span class="var type1" id="S25T2U139">iTP</span>-<span class="mxinfo" id="T2:U99">1</span></span>,:)</span> + <span class="mxinfo" id="T20:U100"><span class="mxinfo" id="T2:U101"><span class="mxinfo" id="T2:U102"><span class="var type1" id="S16T2U144">DT</span></span>./<span class="mxinfo" id="T2:U104"><span class="var type1" id="S17T2U145">TAU</span></span></span>.*(<span class="mxinfo" id="T20:U106"><span class="var type1" id="S5T1U148">v</span>-<span class="mxinfo" id="T20:U108"><span class="var type1" id="S9T1U150">k</span>.*<span class="mxinfo" id="T20:U110"><span class="var type1" id="S3T14U152">activation</span>(<span class="mxinfo" id="T2:U112"><span class="var type1" id="S25T2U154">iTP</span>-<span class="mxinfo" id="T2:U114">1</span></span>,:)</span></span></span>)</span></span> + <span class="mxinfo" id="T20:U115"><span class="mxinfo" id="T2:U116">sqrt(<span class="mxinfo" id="T2:U117"><span class="var type1" id="S16T2U161">DT</span>./<span class="var type1" id="S17T2U162">TAU</span></span>)</span>.*<span class="var type1" id="S30T20U163">Xi</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,162" id="srcline162">162</a></span><span class="line">      </span></span>
<span class="srcline"><span class="lineno"><a href="1,163" id="srcline163">163</a></span><span class="line">      <span class="comment">% Reset activation level if it goes below zero</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,164" id="srcline164">164</a></span><span class="line">      <span class="mxinfo" id="T20:U121"><span class="mxinfo" id="T20:U122"><span class="var type1" id="S3T14U167">activation</span>(<span class="var type1" id="S25T2U168">iTP</span>,(<span class="mxinfo" id="T3:U125"><span class="mxinfo" id="T20:U126"><span class="var type1" id="S3T14U172">activation</span>(<span class="var type1" id="S25T2U173">iTP</span>,:)</span> &lt; <span class="mxinfo" id="T2:U129">0</span></span>))</span> = <span class="mxinfo" id="T2:U130">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,165" id="srcline165">165</a></span><span class="line">      </span></span>
<span class="srcline"><span class="lineno"><a href="1,166" id="srcline166">166</a></span><span class="line">      <span class="comment">% Proportion of accumulators above threshold</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,167" id="srcline167">167</a></span><span class="line">      <span class="mxinfo" id="T2:U131"><span class="var type1" id="S28T2U179">prop</span> = <span class="mxinfo" id="T2:U133"><span class="mxinfo" id="T2:U134">sum(<span class="mxinfo" id="T3:U135"><span class="mxinfo" id="T20:U136"><span class="var type1" id="S3T14U185">activation</span>(<span class="var type1" id="S25T2U186">iTP</span>,:)</span> &gt; <span class="var type1" id="S8T1U188">theta</span></span>)</span>/<span class="var type1" id="S18T2U189">nA</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,168" id="srcline168">168</a></span><span class="line">      </span></span>
<span class="srcline"><span class="lineno"><a href="1,169" id="srcline169">169</a></span><span class="line">      <span class="keyword">if</span> <span class="mxinfo" id="T7:U141">isinf(<span class="var type1" id="S2T2U195">rt</span>)</span> &amp;&amp; <span class="mxinfo" id="T7:U143">all(<span class="mxinfo" id="T40:U144"><span class="var type1" id="S28T2U199">prop</span> &gt;= <span class="var type1" id="S12T1U200">pN</span></span>)</span> <span class="comment">% Determine RT if sufficient number of accumulators have reached threshold</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,170" id="srcline170">170</a></span><span class="line">         </span></span>
<span class="srcline"><span class="lineno"><a href="1,171" id="srcline171">171</a></span><span class="line">         <span class="comment">% Identify critical accumulator (i.e. crossed threshold most recently) and determine RT</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,172" id="srcline172">172</a></span><span class="line">         <span class="mxinfo" id="T3:U147"><span class="var type1" id="S34T3U203">iCrossed</span> = <span class="mxinfo" id="T3:U149"><span class="mxinfo" id="T20:U150"><span class="mxinfo" id="T20:U151"><span class="var type1" id="S3T14U207">activation</span>(<span class="var type1" id="S25T2U208">iTP</span>,:)</span> - <span class="var type1" id="S8T1U210">theta</span></span> &gt; <span class="mxinfo" id="T2:U155">0</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,173" id="srcline173">173</a></span><span class="line">         <span class="mxinfo" id="T20:U156"><span class="var type1" id="S35T20U214">iCritical</span> = <span class="mxinfo" id="T20:U158">find(<span class="mxinfo" id="T3:U159"><span class="mxinfo" id="T20:U160"><span class="mxinfo" id="T20:U161"><span class="var type1" id="S3T14U220">activation</span>(<span class="var type1" id="S25T2U221">iTP</span>,:)</span> - <span class="var type1" id="S8T1U223">theta</span></span> == <span class="mxinfo" id="T2:U165">min(<span class="mxinfo" id="T20:U166"><span class="mxinfo" id="T20:U167"><span class="var type1" id="S3T14U228">activation</span>(<span class="var type1" id="S25T2U229">iTP</span>,<span class="var type1" id="S34T3U230">iCrossed</span>)</span>-<span class="mxinfo" id="T20:U171"><span class="var type1" id="S8T1U232">theta</span>(<span class="var type1" id="S34T3U233">iCrossed</span>)</span></span>)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,174" id="srcline174">174</a></span><span class="line">         <span class="mxinfo" id="T2:U174"><span class="var type1" id="S35T2U236">iCritical</span> = <span class="mxinfo" id="T2:U176"><span class="var type1" id="S35T20U238">iCritical</span>(<span class="mxinfo" id="T2:U178">1</span>)</span></span>; <span class="comment">% This is because when r equals 1, all accumulators cross at the same time</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,175" id="srcline175">175</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,176" id="srcline176">176</a></span><span class="line">         <span class="mxinfo" id="T33:U179"><span class="var type1" id="S38T33U242">actAroundThres</span> = <span class="mxinfo" id="T33:U181"><span class="var type1" id="S3T14U244">activation</span>(<span class="mxinfo" id="T33:U183"><span class="mxinfo" id="T2:U184"><span class="var type1" id="S25T2U247">iTP</span>-1</span>:<span class="var type1" id="S25T2U249">iTP</span></span>,<span class="var type1" id="S35T2U250">iCritical</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,177" id="srcline177">177</a></span><span class="line"><span class="comment">%          tAroundThres = [iTP-1,iTP]';</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,178" id="srcline178">178</a></span><span class="line">         <span class="mxinfo" id="T33:U188"><span class="var type1" id="S39T33U253">tAroundThres</span> = <span class="mxinfo" id="T33:U190"><span class="var type1" id="S16T2U255">DT</span>.*<span class="mxinfo" id="T33:U192"><span class="mxinfo" id="T10:U193">[<span class="mxinfo" id="T2:U194"><span class="var type1" id="S25T2U260">iTP</span>-<span class="mxinfo" id="T2:U196">1</span></span>,<span class="var type1" id="S25T2U262">iTP</span>]</span>'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,179" id="srcline179">179</a></span><span class="line">         <span class="mxinfo" id="T2:U198"><span class="var type1" id="S40T2U265">critThres</span> = <span class="mxinfo" id="T2:U200"><span class="var type1" id="S8T1U267">theta</span>(<span class="var type1" id="S35T2U268">iCritical</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,180" id="srcline180">180</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,181" id="srcline181">181</a></span><span class="line">         <span class="mxinfo" id="T2:U203"><span class="var type1" id="S2T2U271">rt</span> = <span class="mxinfo" id="T2:U205"><span class="mxinfo" id="T2:U206">interp1q(<span class="var type1" id="S38T33U275">actAroundThres</span>,<span class="var type1" id="S39T33U276">tAroundThres</span>,<span class="var type1" id="S40T2U277">critThres</span>)</span> + <span class="var type1" id="S11T2U278">effTime</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,182" id="srcline182">182</a></span><span class="line">         </span></span>
<span class="srcline"><span class="lineno"><a href="1,183" id="srcline183">183</a></span><span class="line">         <span class="comment">% Adjust RT to temporal resolution</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,184" id="srcline184">184</a></span><span class="line">         <span class="mxinfo" id="T2:U211"><span class="var type1" id="S2T2U281">rt</span> = <span class="mxinfo" id="T2:U213"><span class="mxinfo" id="T2:U214">round(<span class="mxinfo" id="T2:U215"><span class="var type1" id="S2T2U286">rt</span>./<span class="mxinfo" id="T2:U217"><span class="var type1" id="S16T2U287">DT</span></span></span>)</span>.*<span class="var type1" id="S16T2U288">DT</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,185" id="srcline185">185</a></span><span class="line">         </span></span>
<span class="srcline"><span class="lineno"><a href="1,186" id="srcline186">186</a></span><span class="line">         <span class="mxinfo" id="T2:U220"><span class="var type1" id="S2T2U291">rt</span> = <span class="var type1" id="S2T2U293">rt</span>(1)</span>; <span class="comment">% If interp1q returns vector rather than scalar</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,187" id="srcline187">187</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,188" id="srcline188">188</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,189" id="srcline189">189</a></span><span class="line">      <span class="keyword">if</span> <span class="mxinfo" id="T7:U223"><span class="mxinfo" id="T2:U224"><span class="var type1" id="S25T2U299">iTP</span>.*<span class="var type1" id="S16T2U300">DT</span></span> &gt; <span class="var type1" id="S2T2U301">rt</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,190" id="srcline190">190</a></span><span class="line">            <span class="comment">% Keep data from selected accumulators</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,191" id="srcline191">191</a></span><span class="line">            <span class="mxinfo" id="T14:U228"><span class="var type1" id="S3T14U304">activation</span> = <span class="mxinfo" id="T14:U230"><span class="var type1" id="S3T14U306">activation</span>(:,<span class="var type1" id="S14T1U308">iAT</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,192" id="srcline192">192</a></span><span class="line">            <span class="keyword">break</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,193" id="srcline193">193</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,194" id="srcline194">194</a></span><span class="line">         </span></span>
<span class="srcline"><span class="lineno"><a href="1,195" id="srcline195">195</a></span><span class="line">      <span class="keyword">if</span> <span class="mxinfo" id="T7:U233"><span class="var type1" id="S25T2U313">iTP</span> &gt; <span class="mxinfo" id="T2:U235"><span class="var type1" id="S4T2U315">nTP</span>-<span class="mxinfo" id="T2:U237">1</span></span></span> <span class="comment">% If trial end (i.e. maximum number of time points) has been reached</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,196" id="srcline196">196</a></span><span class="line">         <span class="comment">% Keep data from selected accumulators</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,197" id="srcline197">197</a></span><span class="line">         <span class="mxinfo" id="T2:U238"><span class="var type1" id="S2T2U319">rt</span> = <span class="mxinfo" id="T2:U240">nan</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,198" id="srcline198">198</a></span><span class="line">         <span class="mxinfo" id="T14:U241"><span class="var type1" id="S3T14U324">activation</span> = <span class="mxinfo" id="T14:U243"><span class="var type1" id="S3T14U326">activation</span>(:,<span class="var type1" id="S14T1U328">iAT</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,199" id="srcline199">199</a></span><span class="line">         <span class="keyword">break</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,200" id="srcline200">200</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,201" id="srcline201">201</a></span><span class="line">      </span></span>
<span class="srcline"><span class="lineno"><a href="1,202" id="srcline202">202</a></span><span class="line">      <span class="mxinfo" id="T2:U246"><span class="var type1" id="S25T2U332">iTP</span> = <span class="mxinfo" id="T2:U248"><span class="var type1" id="S25T2U334">iTP</span> + <span class="mxinfo" id="T2:U250">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,203" id="srcline203">203</a></span><span class="line">      </span></span>
<span class="srcline"><span class="lineno"><a href="1,204" id="srcline204">204</a></span><span class="line">   <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,205" id="srcline205">205</a></span><span class="line"><span class="keyword">elseif</span> <span class="mxinfo" id="T7:U251"><span class="var type1" id="S13T2U338">dMeth</span> == <span class="mxinfo" id="T2:U253">2</span></span> <span class="comment">% Pooling</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,206" id="srcline206">206</a></span><span class="line">   <span class="mxinfo" id="T35:U254"><span class="var type1" id="S43T35U342">mActivation</span> = <span class="mxinfo" id="T35:U256">zeros(<span class="var type1" id="S4T2U345">nTP</span>,1)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,207" id="srcline207">207</a></span><span class="line">   <span class="mxinfo" id="T2:U258"><span class="var type1" id="S44T2U349">mThreshold</span> = <span class="mxinfo" id="T2:U260">mean(<span class="var type1" id="S8T1U352">theta</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,208" id="srcline208">208</a></span><span class="line">   <span class="keyword">while</span> <span class="mxinfo" id="T7:U262"><span class="var type1" id="S25T2U355">iTP</span> &lt; <span class="mxinfo" id="T2:U264">Inf</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,209" id="srcline209">209</a></span><span class="line">      </span></span>
<span class="srcline"><span class="lineno"><a href="1,210" id="srcline210">210</a></span><span class="line">      <span class="comment">% Compute activation level in all accumulators</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,211" id="srcline211">211</a></span><span class="line">      <span class="mxinfo" id="T20:U265"><span class="mxinfo" id="T20:U266"><span class="var type1" id="S3T14U361">activation</span>(<span class="var type1" id="S25T2U362">iTP</span>,:)</span> = <span class="mxinfo" id="T20:U269"><span class="mxinfo" id="T20:U270"><span class="mxinfo" id="T20:U271"><span class="var type1" id="S3T14U367">activation</span>(<span class="mxinfo" id="T2:U273"><span class="var type1" id="S25T2U369">iTP</span>-<span class="mxinfo" id="T2:U275">1</span></span>,:)</span> + <span class="mxinfo" id="T20:U276"><span class="mxinfo" id="T2:U277"><span class="mxinfo" id="T2:U278"><span class="var type1" id="S16T2U374">DT</span></span>./<span class="mxinfo" id="T2:U280"><span class="var type1" id="S17T2U375">TAU</span></span></span>.*(<span class="mxinfo" id="T20:U282"><span class="var type1" id="S5T1U378">v</span>-<span class="mxinfo" id="T20:U284"><span class="var type1" id="S9T1U380">k</span>.*<span class="mxinfo" id="T20:U286"><span class="var type1" id="S3T14U382">activation</span>(<span class="mxinfo" id="T2:U288"><span class="var type1" id="S25T2U384">iTP</span>-<span class="mxinfo" id="T2:U290">1</span></span>,:)</span></span></span>)</span></span> + <span class="mxinfo" id="T2:U291"><span class="mxinfo" id="T2:U292"><span class="mxinfo" id="T2:U293">sqrt(<span class="mxinfo" id="T2:U294"><span class="var type1" id="S16T2U392">DT</span>./<span class="var type1" id="S17T2U393">TAU</span></span>)</span>.*<span class="var type1" id="S6T2U394">sigmaXi</span></span>.*<span class="mxinfo" id="T2:U298">randn(1,1)</span></span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,212" id="srcline212">212</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,213" id="srcline213">213</a></span><span class="line">      <span class="comment">% Reset activation level if it goes below zero</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,214" id="srcline214">214</a></span><span class="line">      <span class="mxinfo" id="T20:U299"><span class="mxinfo" id="T20:U300"><span class="var type1" id="S3T14U402">activation</span>(<span class="var type1" id="S25T2U403">iTP</span>,(<span class="mxinfo" id="T3:U303"><span class="mxinfo" id="T20:U304"><span class="var type1" id="S3T14U407">activation</span>(<span class="var type1" id="S25T2U408">iTP</span>,:)</span> &lt; <span class="mxinfo" id="T2:U307">0</span></span>))</span> = <span class="mxinfo" id="T2:U308">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,215" id="srcline215">215</a></span><span class="line">      </span></span>
<span class="srcline"><span class="lineno"><a href="1,216" id="srcline216">216</a></span><span class="line">      <span class="comment">% Compute mean activation level across all accumulators</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,217" id="srcline217">217</a></span><span class="line">      <span class="mxinfo" id="T2:U309"><span class="mxinfo" id="T2:U310"><span class="var type1" id="S43T35U415">mActivation</span>(<span class="var type1" id="S25T2U416">iTP</span>)</span> = <span class="mxinfo" id="T2:U313">mean(<span class="mxinfo" id="T20:U314"><span class="var type1" id="S3T14U420">activation</span>(<span class="var type1" id="S25T2U421">iTP</span>,:)</span>)</span></span>; </span></span>
<span class="srcline"><span class="lineno"><a href="1,218" id="srcline218">218</a></span><span class="line">      </span></span>
<span class="srcline"><span class="lineno"><a href="1,219" id="srcline219">219</a></span><span class="line">      <span class="keyword">if</span> <span class="mxinfo" id="T7:U317">isinf(<span class="var type1" id="S2T2U428">rt</span>)</span> &amp;&amp; <span class="mxinfo" id="T7:U319">all(<span class="mxinfo" id="T7:U320"><span class="mxinfo" id="T2:U321"><span class="var type1" id="S43T35U433">mActivation</span>(<span class="var type1" id="S25T2U434">iTP</span>)</span> &gt; <span class="var type1" id="S44T2U435">mThreshold</span></span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,220" id="srcline220">220</a></span><span class="line">         </span></span>
<span class="srcline"><span class="lineno"><a href="1,221" id="srcline221">221</a></span><span class="line">         <span class="mxinfo" id="T33:U325"><span class="var type1" id="S38T33U438">actAroundThres</span> = <span class="mxinfo" id="T33:U327"><span class="var type1" id="S43T35U440">mActivation</span>(<span class="mxinfo" id="T33:U329"><span class="mxinfo" id="T2:U330"><span class="var type1" id="S25T2U443">iTP</span>-1</span>:<span class="var type1" id="S25T2U445">iTP</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,222" id="srcline222">222</a></span><span class="line"><span class="comment">%          tAroundThres = [iTP-1,iTP]';</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,223" id="srcline223">223</a></span><span class="line">         <span class="mxinfo" id="T33:U333"><span class="var type1" id="S39T33U448">tAroundThres</span> = <span class="mxinfo" id="T33:U335"><span class="var type1" id="S16T2U450">DT</span>.*<span class="mxinfo" id="T33:U337"><span class="mxinfo" id="T10:U338">[<span class="mxinfo" id="T2:U339"><span class="var type1" id="S25T2U455">iTP</span>-<span class="mxinfo" id="T2:U341">1</span></span>,<span class="var type1" id="S25T2U457">iTP</span>]</span>'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,224" id="srcline224">224</a></span><span class="line">         </span></span>
<span class="srcline"><span class="lineno"><a href="1,225" id="srcline225">225</a></span><span class="line">         <span class="mxinfo" id="T2:U343"><span class="var type1" id="S2T2U460">rt</span> = <span class="mxinfo" id="T2:U345"><span class="mxinfo" id="T2:U346">interp1q(<span class="var type1" id="S38T33U464">actAroundThres</span>,<span class="var type1" id="S39T33U465">tAroundThres</span>,<span class="var type1" id="S44T2U466">mThreshold</span>)</span> + <span class="var type1" id="S11T2U467">effTime</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,226" id="srcline226">226</a></span><span class="line">         </span></span>
<span class="srcline"><span class="lineno"><a href="1,227" id="srcline227">227</a></span><span class="line">         <span class="comment">% Adjust RT to temporal resolution</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,228" id="srcline228">228</a></span><span class="line">         <span class="mxinfo" id="T2:U351"><span class="var type1" id="S2T2U470">rt</span> = <span class="mxinfo" id="T2:U353"><span class="mxinfo" id="T2:U354">round(<span class="mxinfo" id="T2:U355"><span class="var type1" id="S2T2U475">rt</span>./<span class="mxinfo" id="T2:U357"><span class="var type1" id="S16T2U476">DT</span></span></span>)</span>.*<span class="var type1" id="S16T2U477">DT</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,229" id="srcline229">229</a></span><span class="line">         </span></span>
<span class="srcline"><span class="lineno"><a href="1,230" id="srcline230">230</a></span><span class="line">         <span class="mxinfo" id="T2:U360"><span class="var type1" id="S2T2U480">rt</span> = <span class="var type1" id="S2T2U482">rt</span>(1)</span>; <span class="comment">% In case inetrp1q returns vector rather than scalar</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,231" id="srcline231">231</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,232" id="srcline232">232</a></span><span class="line">      </span></span>
<span class="srcline"><span class="lineno"><a href="1,233" id="srcline233">233</a></span><span class="line">      <span class="keyword">if</span> <span class="mxinfo" id="T7:U363"><span class="mxinfo" id="T2:U364"><span class="var type1" id="S25T2U488">iTP</span>.*<span class="var type1" id="S16T2U489">DT</span></span> &gt; <span class="var type1" id="S2T2U490">rt</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,234" id="srcline234">234</a></span><span class="line">         <span class="mxinfo" id="T14:U368"><span class="var type1" id="S3T14U493">activation</span> = <span class="mxinfo" id="T14:U370"><span class="var type1" id="S3T14U495">activation</span>(:,<span class="var type1" id="S14T1U497">iAT</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,235" id="srcline235">235</a></span><span class="line">         <span class="keyword">break</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,236" id="srcline236">236</a></span><span class="line"><span class="comment">%          activation = mActivation;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,237" id="srcline237">237</a></span><span class="line"><span class="comment">%          activation(iTP+1:end) = nan;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,238" id="srcline238">238</a></span><span class="line"><span class="comment">%          break</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,239" id="srcline239">239</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,240" id="srcline240">240</a></span><span class="line">         </span></span>
<span class="srcline"><span class="lineno"><a href="1,241" id="srcline241">241</a></span><span class="line">      <span class="keyword">if</span> <span class="mxinfo" id="T7:U373"><span class="var type1" id="S25T2U502">iTP</span> &gt; <span class="mxinfo" id="T2:U375"><span class="var type1" id="S4T2U504">nTP</span>-<span class="mxinfo" id="T2:U377">1</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="1,242" id="srcline242">242</a></span><span class="line">         <span class="comment">% Keep data from selected accumulators</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,243" id="srcline243">243</a></span><span class="line">         <span class="mxinfo" id="T2:U378"><span class="var type1" id="S2T2U508">rt</span> = <span class="mxinfo" id="T2:U380">nan</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,244" id="srcline244">244</a></span><span class="line">         <span class="mxinfo" id="T14:U381"><span class="var type1" id="S3T14U513">activation</span> = <span class="mxinfo" id="T14:U383"><span class="var type1" id="S3T14U515">activation</span>(:,<span class="var type1" id="S14T1U517">iAT</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,245" id="srcline245">245</a></span><span class="line">         <span class="keyword">break</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,246" id="srcline246">246</a></span><span class="line"><span class="comment">%          rt = nan;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,247" id="srcline247">247</a></span><span class="line"><span class="comment">%          activation = mActivation;</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,248" id="srcline248">248</a></span><span class="line"><span class="comment">%          break</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,249" id="srcline249">249</a></span><span class="line">      <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,250" id="srcline250">250</a></span><span class="line">      </span></span>
<span class="srcline"><span class="lineno"><a href="1,251" id="srcline251">251</a></span><span class="line">      <span class="mxinfo" id="T2:U386"><span class="var type1" id="S25T2U521">iTP</span> = <span class="mxinfo" id="T2:U388"><span class="var type1" id="S25T2U523">iTP</span> + <span class="mxinfo" id="T2:U390">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,252" id="srcline252">252</a></span><span class="line">      </span></span>
<span class="srcline"><span class="lineno"><a href="1,253" id="srcline253">253</a></span><span class="line">   <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,254" id="srcline254">254</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,255" id="srcline255">255</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,256" id="srcline256">256</a></span><span class="line"><span class="comment">% Transform to 1-ms steps</span></span></span>
<span class="srcline"><span class="lineno"><a href="1,257" id="srcline257">257</a></span><span class="line"><span class="mxinfo" id="T20:U391"><span class="var type1" id="S46T20U527">t</span> = <span class="mxinfo" id="T20:U393"><span class="var type1" id="S16T2U530">DT</span>:<span class="var type1" id="S16T2U531">DT</span>:<span class="var type1" id="S4T2U532">nTP</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,258" id="srcline258">258</a></span><span class="line"><span class="mxinfo" id="T14:U397"><span class="var type1" id="S3T14U535">activation</span> = <span class="mxinfo" id="T14:U399">interp1(<span class="var type1" id="S46T20U538">t</span>,<span class="var type1" id="S3T14U539">activation</span>,<span class="mxinfo" id="T20:U402">colon(1,<span class="var type1" id="S4T2U543">nTP</span>)</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="1,259" id="srcline259">259</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,260" id="srcline260">260</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,261" id="srcline261">261</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,262" id="srcline262">262</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="1,263" id="srcline263">263</a></span><span class="line"></span></span>
</pre>
